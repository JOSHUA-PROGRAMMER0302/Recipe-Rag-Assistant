<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dashboard - Recipe Rag Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="api_base.js"></script>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <header class="bg-white shadow">
      <div class="max-w-4xl mx-auto py-6 px-4 sm:px-6 lg:px-8 flex items-center justify-between">
        <h1 class="text-2xl font-bold text-gray-900">Dashboard</h1>
        <nav class="space-x-3">
          <a href="index.html" class="text-blue-600">Search</a>
          <a href="planner.html" class="text-blue-600">Planner</a>
          <a href="dashboard.html" class="text-blue-600">Dashboard</a>
        </nav>
      </div>
    </header>
    <main class="max-w-4xl mx-auto p-4">
      <section class="bg-white p-4 rounded shadow">
        <h2 class="font-semibold">Compression Status</h2>
        <div class="mt-3">
          <button id="refreshBtn" class="px-3 py-2 bg-indigo-600 text-white rounded">Refresh</button>
        </div>
        <div id="statusArea" class="mt-4 text-sm text-gray-700"></div>
      </section>
      <section class="mt-6 bg-white p-4 rounded shadow">
        <h2 class="font-semibold">Quick Links</h2>
        <ul class="mt-2">
          <li><a class="text-blue-600" href="planner.html">Open Planner</a></li>
          <li><a class="text-blue-600" href="index.html">Search Recipes</a></li>
        </ul>
      </section>
    </main>

    <script>
      const refreshBtn = document.getElementById('refreshBtn')
      const statusArea = document.getElementById('statusArea')

      const API_BASE = window.API_BASE || 'http://localhost:8000'

      async function refresh() {
        const res = await fetch(`${API_BASE}/compress-status?limit=50`)
        const data = await res.json()
        statusArea.innerHTML = ''
        statusArea.innerHTML += `<div><strong>Total compressed:</strong> ${data.count}</div>`
        statusArea.innerHTML += `<div><strong>Bytes saved:</strong> ${data.bytes_saved || 0}</div>`
        if (data.entries && data.entries.length) {
          statusArea.innerHTML += '<h4 class="mt-3 font-medium">Entries</h4>'
          const list = document.createElement('ul')
          list.className = 'mt-2 space-y-1 text-sm'
          data.entries.forEach(e => {
            const li = document.createElement('li')
            li.className = 'p-1 border rounded'
            li.textContent = `${e.id} â€” method=${e.method} orig=${e.orig_len || 'n/a'} comp=${e.compressed_len || 'n/a'}`
            list.appendChild(li)
          })
          statusArea.appendChild(list)
        }
      }

      refreshBtn.addEventListener('click', refresh)
      // auto-refresh on load
      refresh()
    </script>
  </body>
</html>
